EOI EQU 20h
IMR EQU 21h
INT0 EQU 24h
IDINT0 EQU 10
PA EQU 30h
PB EQU 31h
CA EQU 32h
CB EQU 33h

        ORG 1000H
        FLAG DB 0
        LONGITUD DB 0
        CADENA DB ?

        ORG 40
        DIR_RUT DW RUT_F10

        ORG 3000H
; CANCELAR INTERRUPCIONES FUTURAS
        RUT_F10: MOV AL, 0FFH
        OUT IMR, AL

; INDICAMOS AL PROGRAMA QUE NO LEA MÁS
        MOV FLAG,1
        MOV AL,24H
        OUT EOI, AL
        IRET

ORG 2000H
CLI
; INICIALIZACION PIO PARA IMPRESORA
        MOV AL, 0FDH
        OUT CA, AL
        MOV AL, 0
        OUT CB, AL
        IN AL, PA
        AND AL, 0FDH
        OUT PA, AL

; INICIALIZACIÓN DEL PIC
        MOV AL, 0FEH ; FE = 1111 1110
        OUT IMR, AL
        MOV AL, IDINT0
        OUT INT0, AL
        STI

; LECTURA DE CADENA
        MOV BX, OFFSET CADENA
  LOOP: INT 6 ; LEER CHAR
        INC BX
        INC LONGITUD
        CMP FLAG, 0 ; VERIFICO SI PRESIONARON F10
        JZ LOOP

; IMPRESIÓN DE LOS CARACTERES LEÍDOS
        MOV BX, OFFSET CADENA ; REINICIAR PUNTERO AL COMIENZO
  POLL: NOP
        IN AL, PA
        AND AL, 1
        JNZ POLL

        ; ENVIAR CARÁCTER
        MOV AL, [BX]
        OUT PB, AL

        ; PULSO STROBE
        IN AL, PA
        OR AL, 02H
        OUT PA, AL
        ; REINICIAR STROBE
        IN AL, PA
        AND AL, 0FDH
        OUT PA, AL

        ; PASAR AL SIGUIENTE CHAR
        INC BX
        DEC LONGITUD
        JNZ POLL

        INT 0
        END

